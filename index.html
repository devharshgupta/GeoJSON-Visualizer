<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>GeoJSON Visualizer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin=""
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      }
      #container {
        display: flex;
        height: 100%;
      }
      #map {
        flex: 1;
      }
      #panel {
        width: 350px;
        max-width: 40%;
        background: #fafafa;
        border-left: 1px solid #ddd;
        padding: 10px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }
      #panel h2 {
        margin: 0 0 5px 0;
        font-size: 16px;
      }
      #controls {
        flex: 0 0 auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      textarea {
        flex: 1 1 auto;
        width: 100%;
        resize: none;
        font-family: monospace;
        font-size: 13px;
        padding: 6px;
        box-sizing: border-box;
      }
      input[type="text"] {
        width: 100%;
        padding: 6px;
        box-sizing: border-box;
      }
      button {
        padding: 6px 10px;
        cursor: pointer;
      }
      #status {
        font-size: 12px;
        color: #444;
        margin-top: 5px;
        white-space: pre-wrap;
      }
      #footer {
        margin-top: 10px;
        text-align: center;
        flex: 0 0 auto;
      }
      #footer a {
        display: inline-block;
        margin: 4px;
        padding: 6px 12px;
        border-radius: 6px;
        text-decoration: none;
        color: white;
        font-size: 13px;
      }
      .linkedin {
        background: #0077b5;
      }
      .coffee {
        background: #ff813f;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="map"></div>
      <div id="panel">
        <h2>GeoJSON Loader</h2>
        <div id="controls">
          <label for="urlInput">GeoJSON URL:</label>
          <input
            type="text"
            id="urlInput"
            placeholder="https://example.com/data.geojson"
          />
          <button id="loadUrlBtn">Load from URL</button>
          <label for="geojsonInput">GeoJSON Data:</label>
        </div>
        <textarea id="geojsonInput">
 {
  "type": "FeatureCollection",
  "features": []
} </textarea
        >
        <button id="renderBtn">Render GeoJSON</button>
        <div id="status">Preloaded some sample data...</div>
        <div id="footer">
          <a
            href="https://www.linkedin.com/in/devharshgupta/"
            target="_blank"
            class="linkedin"
            >Connect on LinkedIn</a
          >
          <a
            href="https://buymeacoffee.com/devharshgupta"
            target="_blank"
            class="coffee"
            >â˜• Support Me</a
          >
        </div>
      </div>
    </div>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      crossorigin=""
    ></script>

    <script>
      const map = L.map("map", {
        center: [20.0, 78.0],
        zoom: 4,
      });

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      const canvasRenderer = L.canvas({ padding: 0.5 });
      let geoLayer = null;

      function randomColor() {
        const hue = Math.floor(Math.random() * 360);
        return `hsl(${hue}, 70%, 50%)`;
      }

      function featureStyle() {
        const color = randomColor();
        return {
          renderer: canvasRenderer,
          color,
          weight: 1,
          opacity: 0.9,
          fillColor: color,
          fillOpacity: 0.4,
        };
      }

      function onEachFeature(feature, layer) {
        const props = feature.properties || {};
        let html = '<div style="font-size:12px">';
        for (const k in props) {
          html += `<b>${k}</b>: ${props[k]}<br/>`;
        }
        html += "</div>";
        if (html !== '<div style="font-size:12px"></div>') {
          layer.bindPopup(html);
        }
      }

      function renderGeoJSON(geojson) {
        if (geoLayer) map.removeLayer(geoLayer);
        geoLayer = L.geoJSON(geojson, {
          style: featureStyle,
          onEachFeature,
        }).addTo(map);
        try {
          map.fitBounds(geoLayer.getBounds());
        } catch {}
      }

      function initialGeoJSON(geojson) {
        if (geoLayer) map.removeLayer(geoLayer);
        geoLayer = L.geoJSON(geojson, {
          style: featureStyle,
          onEachFeature,
        }).addTo(map);
        try {
          map.fitBounds(geoLayer.getBounds());
        } catch {}
      }

      document.getElementById("renderBtn").addEventListener("click", () => {
        const txt = document.getElementById("geojsonInput").value;
        try {
          const data = JSON.parse(txt);
          renderGeoJSON(data);
          setStatus("Rendered GeoJSON successfully.");
        } catch (e) {
          setStatus("Invalid JSON: " + e.message);
        }
      });

      document
        .getElementById("loadUrlBtn")
        .addEventListener("click", async () => {
          const url = document.getElementById("urlInput").value.trim();
          if (!url) {
            setStatus("Enter a URL first.");
            return;
          }
          setStatus("Fetching " + url + " ...");
          try {
            const resp = await fetch(url);
            if (!resp.ok) throw new Error("HTTP " + resp.status);
            const data = await resp.json();
            document.getElementById("geojsonInput").value = JSON.stringify(
              data,
              null,
              2
            );
            renderGeoJSON(data);
            setStatus("Loaded successfully.");
          } catch (e) {
            setStatus("Error: " + e.message);
          }
        });

      function setStatus(msg) {
        document.getElementById("status").textContent = msg;
      }

      // Auto-load sample data on startup
      async function loadSample() {
        const sampleUrl =
          "https://github.com/devharshgupta/Pan-India-Pincode-Data/releases/download/v1/india_pincode.geojson";
        try {
          const resp = await fetch(sampleUrl);
          if (!resp.ok) throw new Error("HTTP " + resp.status);
          const data = await resp.json();
          document.getElementById("geojsonInput").value = JSON.stringify(
            data,
            null,
            2
          );
          renderGeoJSON(data);
          setStatus("Sample data loaded successfully.");
        } catch (e) {
          setStatus("Failed to load sample data: " + e.message);
        }
      }

      initialGeoJSON({
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            properties: {
              Pincode: "110011",
              Office_Name: "Nirman Bhawan SO",
              Division: "New Delhi Central ",
              Region: "",
              Circle: "Delhi ",
            },
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [77.203792, 28.613688],
                  [77.201775, 28.613751],
                  [77.201757, 28.613195],
                  [77.200602, 28.613245],
                  [77.200597, 28.613245],
                  [77.200559, 28.613245],
                  [77.19943, 28.613231],
                  [77.198884, 28.613337],
                  [77.19811, 28.613331],
                  [77.194069, 28.614057],
                  [77.191228, 28.613949],
                  [77.190326, 28.61379],
                  [77.189929, 28.613706],
                  [77.189974, 28.613335],
                  [77.190006, 28.613186],
                  [77.190032, 28.61306],
                  [77.190046, 28.612988],
                  [77.19009, 28.612754],
                  [77.190151, 28.612435],
                  [77.190371, 28.611849],
                  [77.190483, 28.611486],
                  [77.190644, 28.611044],
                  [77.190781, 28.610808],
                  [77.190853, 28.61069],
                  [77.190875, 28.610635],
                  [77.190883, 28.610615],
                  [77.190897, 28.610588],
                  [77.190908, 28.610576],
                  [77.190914, 28.610567],
                  [77.190918, 28.610562],
                  [77.190932, 28.610546],
                  [77.190953, 28.610525],
                  [77.19115, 28.61018],
                  [77.191224, 28.609966],
                  [77.191519, 28.609937],
                  [77.190317, 28.609014],
                  [77.190751, 28.608748],
                  [77.191024, 28.608422],
                  [77.191313, 28.608502],
                  [77.191525, 28.608369],
                  [77.191818, 28.608107],
                  [77.191822, 28.608103],
                  [77.192142, 28.607817],
                  [77.192394, 28.607593],
                  [77.192679, 28.607337],
                  [77.192855, 28.60718],
                  [77.19301, 28.607042],
                  [77.19347, 28.60663],
                  [77.193538, 28.606568],
                  [77.19379, 28.606338],
                  [77.193976, 28.606178],
                  [77.193785, 28.605946],
                  [77.193619, 28.605745],
                  [77.19394, 28.605022],
                  [77.194044, 28.604786],
                  [77.193877, 28.604199],
                  [77.193537, 28.604175],
                  [77.193117, 28.604146],
                  [77.19264, 28.604113],
                  [77.1927, 28.603911],
                  [77.192766, 28.603687],
                  [77.192816, 28.603518],
                  [77.192899, 28.603236],
                  [77.19308, 28.602621],
                  [77.193352, 28.602572],
                  [77.193482, 28.602548],
                  [77.193661, 28.602317],
                  [77.193713, 28.60225],
                  [77.193747, 28.602206],
                  [77.194029, 28.601842],
                  [77.194565, 28.601529],
                  [77.195044, 28.601249],
                  [77.195167, 28.601177],
                  [77.195464, 28.601004],
                  [77.195928, 28.600732],
                  [77.19649, 28.600404],
                  [77.196665, 28.600302],
                  [77.197161, 28.600012],
                  [77.197746, 28.59967],
                  [77.197928, 28.599204],
                  [77.198066, 28.598128],
                  [77.198149, 28.597479],
                  [77.198228, 28.596855],
                  [77.198262, 28.596593],
                  [77.198713, 28.596451],
                  [77.198943, 28.596378],
                  [77.199318, 28.59626],
                  [77.199748, 28.596034],
                  [77.206976, 28.596354],
                  [77.20848, 28.594545],
                  [77.209681, 28.591455],
                  [77.212858, 28.591644],
                  [77.213671, 28.592516],
                  [77.214486, 28.593391],
                  [77.216432, 28.595477],
                  [77.219392, 28.598652],
                  [77.221581, 28.599265],
                  [77.222461, 28.599161],
                  [77.224209, 28.60356],
                  [77.226976, 28.607042],
                  [77.225793, 28.607683],
                  [77.226233, 28.608925],
                  [77.227344, 28.609757],
                  [77.22783, 28.609351],
                  [77.228069, 28.609418],
                  [77.22816, 28.609484],
                  [77.228454, 28.609087],
                  [77.229251, 28.610314],
                  [77.229234, 28.610325],
                  [77.228901, 28.610528],
                  [77.228472, 28.610784],
                  [77.227557, 28.611952],
                  [77.224789, 28.612084],
                  [77.224724, 28.613167],
                  [77.203921, 28.614147],
                  [77.2039, 28.613685],
                  [77.203794, 28.613688],
                  [77.203792, 28.613688],
                ],
              ],
            },
          },
        ],
      });
    </script>
  </body>
</html>
